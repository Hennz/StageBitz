<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>STAGEBITZ</title>
        
        
        
    </head>
    <body>
        <div data-role="page" id="item">
            
            
            <script type="text/javascript">
                var itemName;
                var itemId;
                var mobileItemId;
                var lastUpdatedDate;
                var sbItemId;
                var companyId;
                //var sbItemId=18009;
                var mySwipe;
                var companyName;
                var numberofGalleryimages=0;
                var inn=0;
                var numberOfImages=0;
                var detailsChanged=false;
                var savetoGallery = true;
                var editMode=false;
                var nextDocumentMediaId;
                var currentLocalImage=0;
                var localImages =new Array();
                var currentServerImage=0;
                var serverImages= new Array();
                var isAllImagesLoaded=false;
                var isItemAlreadySavedInDb = false;
                var itemmHasEdited=false;
                var isImageStillLoading=false;
                var canEditItem=false;
                var cameraPhotoMaxHeight;
              	var cameraPhotoMaxWidth;
                $("#item").on('pageshow',function() {
                              
                              mobileItemId=null;
                              itemName=null;
                               var url = $.url(document.location);
                               sbItemId = url.param("itemId");
                               companyId = url.param("companyId");
                              
                              cameraPhotoMaxHeight= Number(window.localStorage["cameraPhotoHeight"]);
                              cameraPhotoMaxWidth= Number(window.localStorage["cameraPhotoWidth"]);

                              checkSync(function(hasSync){
                                        if(hasSync){
                                        $('.sync img').attr("src","css/images/icons/sync-02.png");
                                        }else{
                                        $('.sync img').attr("src","css/images/icons/sync.png");
                                        }
                            });
                              
                              /*generate  item Name*/
                              if(!sbItemId){
                              
                              companyName = window.sessionStorage["inventoryName"].replace(/\s/g,'');
                              companyId = window.sessionStorage["inventoryType"];
                              var date = new Date();
                              
                              if (companyName.length > 5) {
                              companyName = companyName.substring(0, 5);
                              }
                              
                              
                              var formatedDate=date.toLocaleDateString();
                              var postFix;
                              if(window.localStorage["itemAutoGenerateDate"]!=formatedDate){
                              window.localStorage["itemAutoGenerateDate"]=formatedDate;
                              window.localStorage["itemAutoGenerateID"]="1";
                              
                              }
                              
                              
                              postFix=parseInt(window.localStorage["itemAutoGenerateID"]);
                              //console.log(temppostFix);
                              var temppostFix= postFix + 1;
                              window.localStorage["itemAutoGenerateID"]=temppostFix.toString();
                              
                              //postFix=parseInt(window.localStorage["itemAutoGenerateID"]);
                              //var postFix=parseInt(window.localStorage["itemPostfixNumber"]);
                              //window.localStorage["itemPostfixNumber"]= postFix + 1;
                              
                              //                               var month;
                              //                               if(date.getMonth()+1<10){
                              //                                    month = "0" + (date.getMonth()+1);
                              //                               }else{
                              //                                    month = date.getMonth()+1;
                              //                               }
                              itemName = companyName.toUpperCase() +"-" + (date.getDate()<10?"0":"") + date.getDate() + ((date.getMonth()+1<10)?"0":"") +(date.getMonth()+1) + date.getFullYear()+ "-"+postFix;
                              /*create item in db*/
                              
                              itemId = createItem(itemName, date, companyId);
                              
                              
                              $('#itemName').val(itemName);
                              $('#rightArrow').addClass("disabled");
                              $('#itemStatusLabel').hide();
                              }
                              else{
                              editMode=true;
                              
                              $('#itemName').addClass("disabled");
                              $('#descriptionText').addClass("disabled");
                              $('#quantityText').addClass("disabled");
                              $('#galleryButton').addClass("disabled");
                              $('#cameraButton').addClass("disabled");
                              $('#createItem').addClass("disabled");
                              loadExistingItemDetails(sbItemId, companyId, loadExistingItemDetailsSuccess, loadExistingItemDetailsError);
                              $.mobile.loading( 'show');
                              }
                              
                              
                              var itemTypeSelect = $('#itemTypeList');
                              
                              console.log("options"+itemTypeSelect.children().length);
                              var success = function (tx, results) {
                              itemTypeSelect.children().remove();
                              var len = results.rows.length;
                              if(len > 0){
                              /*generate itemtype dropdown*/
                              for ( var i = 0; i < len; i++) {
                              itemTypeSelect.append('<option value="' + results.rows.item(i).typeid + '">'+ results.rows.item(i).typename+ '</option>');
                              // console.log("id"+results.rows.item(i).typeid);
                              }
                              }
                              if (window.sessionStorage["itemType"] != null && itemTypeSelect.children().length > 0 && sbItemId ==null) {
                              itemTypeSelect.val(window.sessionStorage["itemType"]);
                              console.log("session Type:"+$('#itemTypeList').val());
                              }else if(window.sessionStorage["itemType"] == null && itemTypeSelect.children().length > 0 && sbItemId ==null){
                              itemTypeSelect.val("19");
                              }
                              itemTypeSelect.listview('refresh');
                              }
                              getItemTypeList(success);
                              
                              
                              });
                              
                              $("#item").on('pageshow',function() {
                                            
                                            $('#quantityText').numeric({ decimal: false, negative: false });
                                            
                                            if (window.device.platform == "iOS" && parseFloat(window.device.version) >= 7) {
                                            $('#statusBar').css('display','block');
                                            }
                                            
                                            mySwipe = new Swipe(document.getElementById('slider'),{startSlide: 0,transitionEnd:controlGalleryNavigation });
                                            $('#slider').addClass("disabledGallery");
                                            //                               $('.swipe-wrap').append('<div id="noImage"><img src="css/images/pictures/photo.jpg" alt="Picture" /></div>');
                                            //                                mySwipe.setup();
                                            
                                            //                               var camera = $('#cameraButton');
                                            //                              camera.live('click', function(){
                                            //                                          capturePhoto();
                                            //
                                            //                                         });
                                            //                               var gallery = $('#galleryButton');
                                            //                               gallery.live('click', function(){
                                            //                                            getPhoto();
                                            //
                                            //                                           });
                                            
                                            
                                            if(window.localStorage["savetoGallery"]=="true")
                                            {
                                            savetoGallery=true;
                                            }
                                            else
                                            {
                                            savetoGallery =false;
                                            }
                                            
                                            $('#itemName').on('input', function() {
                                                              detailsChanged=true;
                                                              itemmHasEdited=true;
                                                              // do your stuff
                                                              });
                                            $('#descriptionText').on('input', function() {
                                                                     detailsChanged=true;
                                                                     itemmHasEdited=true;
                                                                     // do your stuff
                                                                     });
                                            $('#quantityText').on('input', function() {
                                                                  detailsChanged=true;
                                                                  itemmHasEdited=true;
                                                                  // do your stuff
                                                                  });
                                            
                                            $( '#itemTypeList').change(function() {
                                                                       detailsChanged=true;
                                                                       itemmHasEdited=true;
                                                                       });
                                            
                                            });
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            function getImagesForExistingItemSuccess(tx, results){
                                                
                                                var len = results.rows.length;
                                                
                                                
                                                for (var i=0; i < len; i++) {
                                                    var imageName=results.rows.item(i).filename;
                                                    //console.log(imageName);
                                                    localImages[i]=imageName;
                                                    console.log(imageName);
                                                    //getAddedImagesforExistingItem(imageName);
                                                }
                                                setFirstImageInGallery();
                                            }
            
            
            
            function getAddedImagesforExistingItem(imageName){
                
                imageCache.getFile(imageName, {create: false}, function(entry) {
                                   
                                   
                                   addLocalPhotoToGallery(entry.fullPath, entry.name, "LOCAL");
                                   },function(msg){
                                   console.log("nonono");
                                   
                                   }
                                   );
            }
            
            //                              function loadNextImageSuccess(data){
            //                                  if(data.Status=="OK"){
            //
            //                                  addserverPhotoToGallery(data.Image);
            //                                  nextDocumentMediaId=data.NextDocumentMediaId;
            //                                  } else{
            //                                      navigator.notification.alert(data.Message, function () { },"Image Loading Failed", "OK");
            //                                  }
            //
            //                              }
            
            function loadExistingItemDetailsError(error){
                var msg = 'Image deletion error: ' + error.code;
                //navigator.notification.alert(msg, null, 'Image Deletion Error');
                console.log(msg);
                $.mobile.loading( 'hide');
                if(!checkConnection()){
                    navigator.notification.alert("Connection lost while connecting to StageBitz. Please check your connecton.", function () {
                                                 $.mobile.changePage("search.html");
                                                 return false;
                                                 }, "Internet Connection Lost", "OK");
                }
                else{
                    navigator.notification.alert("Couldn't connect to StageBitz. Please try again.", function () {
                                                 $.mobile.changePage("search.html");
                                                 return false;
                                                 }, "Server Error", "OK");
                }
            }
            
            function loadExistingItemDetailsSuccess(data){
                
                if(data.Status=="OK"){
                    //alert(data.Name+ "  "+ data.ItemStatus)
                    if(data.DocumentMediaIdList!=null){
                        
                        $.each(data.DocumentMediaIdList,function(i,documentId){
                               
                               serverImages[i]=documentId;
                               
                               
                               });
                    
                    }
                  
                 
                    var success = function (tx, results){
                        //alert(results.rows.length);
                        if(results.rows.length>0){
                            
                            mobileItemId=results.rows.item(0).mobileitemid;
                            isItemAlreadySavedInDb=true;
                            if(data.LastUpdatedDate != results.rows.item(0).createdDate){
                                //dispaly message and load data from service and update/delete item
                                 setDataFromDB(results, data);
                                navigator.notification.alert("This Item has been updated since you last synced. Only your image updates will be saved.", function(){
                                                             
                                                             setDataFromService(data);
                                                             getImagesForExistingItem(results.rows.item(0).mobileitemid, getImagesForExistingItemSuccess);
                                                             //check whether updated item has new images added.
                                                             checkNewImageAddForExistingItem(data,results.rows.item(0).mobileitemid);
                                                             }, "Item Updated", "OK");
                            }else{
                                //load data from db
                                getImagesForExistingItem(results.rows.item(0).mobileitemid, getImagesForExistingItemSuccess);
                                setDataFromDB(results, data);
                                
                            }
                            
                        }else{
                            //load data from service
                            
                            setDataFromService(data);
                            setFirstImageInGallery();
                            
                        }
                        
                    }
                    
                    getExistingitemLastUpdatedDate(sbItemId, success);
//                    
//                    setTimeout(function(){
//                               setFirstImageInGallery();
//                               }, 1000);

                    if(data.CanEditItem==0){
                        $('#itemName').removeClass("disabled");
                        $('#descriptionText').removeClass("disabled");
                        $('#quantityText').removeClass("disabled");
                        $('#itemName').attr( "readOnly", "readOnly" );
                        $('#descriptionText').attr( "readOnly", "readOnly" );
                        $('#quantityText').attr( "readOnly", "readOnly" );
                        $('#galleryButton').addClass("disabled");
                        $('#cameraButton').addClass("disabled");
                        $('#deleteImage').addClass("disabled");
                        $('#createItem').addClass("disabled");
                        
//                        $('#itemTypeList').prop('disabled', true);
//                        $('#itemTypeList').listview('refresh');
                            canEditItem=false;
                    }
                    else{
                        $('#itemName').removeClass("disabled");
                        $('#descriptionText').removeClass("disabled");
                        $('#quantityText').removeClass("disabled");
                        $('#galleryButton').removeClass("disabled");
                        $('#cameraButton').removeClass("disabled");
                        $('#createItem').removeClass("disabled");
                          canEditItem=true;
                          
                         
                    }
                    $('#viewInBrowser').removeClass("disabled");
                    $('#itemTypeList').prop('disabled', true);
                    $('#itemTypeList').addClass("disabled");
                    $('#itemTypeList').listview('refresh');
                    
                   
                   
                }else{
                    navigator.notification.alert(data.Message, function () {
                                                 $.mobile.changePage("search.html");
                                                 return false;
                                                 },"Item Loading Failed", "OK");
                }
                
            }
            
            function setDataFromService(data){
                
                
                
                $('#itemName').val(data.Name);
                $('#itemTypeList').val(data.ItemTypeId);
                $('#descriptionText').val(data.Description);
                $('#quantityText').val(data.Quantity);
                $('#itemStatus').text(data.ItemStatus);
                
                lastUpdatedDate=data.LastUpdatedDate;
                
                
                //                data.Name;
                //                data.ItemTypeId
                //                data.ItemStatus
                //                data.Qunatity
                //                data.description
                //                data.LastUpdatedDate
                //                data.NextDocumentMediaId
                //                data.Status
                //                data.CanEditItem
            }
            
            function setDataFromDB(results, data){
                
                $('#itemName').val(results.rows.item(0).itemname);
                $('#itemTypeList').val(results.rows.item(0).typeid);
                $('#descriptionText').val(results.rows.item(0).description);
                $('#quantityText').val(results.rows.item(0).quantity);
                lastUpdatedDate=data.LastUpdatedDate;
                $('#itemStatus').text(data.ItemStatus);
                
                //results.rows.item(1).status
            }
            function setFirstImageInGallery(){
                
                if(currentServerImage < serverImages.length){
                    
                    if(!isImageStillLoading){
                        isImageStillLoading=true;
                        //loadNextImage(sbItemId, companyId, nextDocumentMediaId, loadNextImageSuccess, loadNextImageError);
                        setNextImageinGallery();
                    }
                    
                }else if (currentLocalImage<localImages.length){
                    
                    loadLocalImagesToGallery();
                }else{
                    $('#rightArrow').addClass("disabled");
                    isAllImagesLoaded=true;
                    $.mobile.loading('hide');
                }
                
            }
            
            function checkNewImageAddForExistingItem(data, mobileItemid){
                var success = function (tx, results){
                    
                    if(results.rows.item(0).imagecount > 0){
                        //update item in db
                        updateExistingItem(mobileItemid, data.Name, data.ItemTypeId, data.Description, data.Quantity, data.LastUpdatedDate);
                        
                    }else{
                        //delete item in db
                        deleteItemfromDB(mobileItemid);
                        mobileItemId=null;
                        
                    }
                    updateSearchResult(sbItemId, data.Name, data.Quantity, data.Description, 0,updateSearchResultSuccess);
                    
                }
                getImageAddCountForExistingItem(mobileItemId, success);
                
            }
            
            function addserverPhotoToGallery(imageData, imageIdentifier, imageType){
                //var gallary = $('.swipe-wrap');
                imageType="SERVICE";
                $('.swipe-wrap').append('<div title="'+imageType+'"><img src="data:image/jpeg;base64,'+imageData+'"title="'+imageIdentifier+'"/></div>');
                manageNoImageInEditorMode();
                
                mySwipe.setup();
              
              inn = Number($('#swipe-wrap').children().length);
              if(inn<=1){
                  //$('#rightArrow').addClass("disabled");
                  $('#leftArrow').addClass("disabled");
              }
              setTimeout(function(){
                   mySwipe.slide(inn-1, 10);
                         $.mobile.loading('hide');
                         }, 100);
                
                
                
            }
            
            function addLocalPhotoToGallery(imageURI, imageName, imageType){
                //var gallary = $('.swipe-wrap');
                imageType="LOCAL";
                $('.swipe-wrap').append('<div title="'+imageType+'"><img src="'+imageURI+'" title="'+imageName+'"/></div>');
                manageNoImageInEditorMode();
                
                mySwipe.setup();
                inn = Number($('#swipe-wrap').children().length);
                if(inn<=1){
                    //$('#rightArrow').addClass("disabled");
                    $('#leftArrow').addClass("disabled");
                }
                setTimeout(function(){
                           mySwipe.slide(inn-1, 10);
                           $.mobile.loading('hide');
                           }, 100);
            }
            
            
            
            function itemNameOnBlur() {
                if ($('#itemName').val() == '' && !editMode){
                	$('#itemName').val(itemName);
                }
            }
            
            function itemNameOnFocus() {
                if ($('#itemName').val() == itemName && !editMode)
                $('#itemName').val('');
            }
            
            function addToGallary(imageURI, imageName){
                var gallary = $('.swipe-wrap');
                //                    if($('#swipe-wrap').children().length == 1){
                //                        $('#noImage').remove();
                //                       $('#deleteImage').removeClass("disabled");
                //                    }
                //                    else if($('#swipe-wrap').children().length > 1){
                //                       $('#deleteImage').addClass("disabled");
                //                    }
                gallary.append('<div><img src="'+imageURI+'" title="'+imageName+'"/></div>');
                
                manageNoImage();
                mySwipe.setup();
                inn = Number($('#swipe-wrap').children().length);
                if(inn<=1){
                    
                    $('#rightArrow').addClass("disabled");
                    $('#leftArrow').addClass("disabled");
                }
                mySwipe.slide(inn-1, 100);
                
            }
            
            function manageNoImage(){
                if($('#swipe-wrap').children().length == 0){
                    $('.swipe-wrap').append('<div id="noImage"><img src="css/images/pictures/photo.jpg" alt="Picture" /></div>');
                    $('#deleteImage').addClass("disabled");
                    $('#rightArrow').addClass("disabled");
                    $('#leftArrow').addClass("disabled");
                    
                }
                else{
                    $('#noImage').remove();
                    $('#deleteImage').removeClass("disabled");
                }
            }
            
            function manageNoImageInEditorMode(){
                if($('#swipe-wrap').children().length == 0){
                    if(currentServerImage < serverImages.length){
                        if(!isImageStillLoading){
                            isImageStillLoading=true;
                            //loadNextImage(sbItemId, companyId, nextDocumentMediaId, loadNextImageSuccess, loadNextImageError);
                            setNextImageinGallery();
                        }
                    
                }else if (currentLocalImage<localImages.length){
                    
                    loadLocalImagesToGallery();
                }else{
                    $('.swipe-wrap').append('<div id="noImage"><img src="css/images/pictures/photo.jpg" alt="Picture" /></div>');
                    $('#deleteImage').addClass("disabled");
                    $('#rightArrow').addClass("disabled");
                    $('#leftArrow').addClass("disabled");
                    
                    
                }
                }  else{
                    $('#noImage').remove();
                    if(canEditItem){
                    $('#deleteImage').removeClass("disabled");
                    }
                }
            
            
            }
            function cameraIconClicked(){
                
                capturePhoto();
                
            }
            function galleryIconClicked(){
                getPhoto();
            }
            
            function getPhoto() {
                // Retrieve image file location from specified source
                navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 100,
                                            destinationType: Camera.DestinationType.FILE_URI,
                                            sourceType: Camera.PictureSourceType.PHOTOLIBRARY});
            }
            function capturePhoto() {
                navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 100, destinationType: Camera.DestinationType.FILE_URI,correctOrientation: true, targetWidth: cameraPhotoMaxWidth, targetHeight: cameraPhotoMaxHeight, saveToPhotoAlbum: savetoGallery});
            }
            
            function onPhotoURISuccess(imageURI) {
                createFileEntry(imageURI);
            }
            
            function onFail(message) {
                console.log("Failed to load picture because: "+message);
                //navigator.notification.alert("Failed to load picture because: "+message, function(){}, "Image Loading Failed", "OK");
            }
            
            function createFileEntry(imageURI) {
                window.resolveLocalFileSystemURI(imageURI, copyPhoto, fail);
            }
            
            function copyPhoto(fileEntry) {
                var d = new Date();
                var n = d.getTime();
                //new file name
                var newFileName = n + ".jpg";
                
                root.getDirectory("ImageCache", {create: true, exclusive: false}, function(dir) {
                                  fileEntry.copyTo(dir, newFileName, onCopySuccess, fail);
                                  }, fail);
                                  
            }
            
            function onCopySuccess(entry) {
                // navigator.notification.alert(entry.name);
                console.log(entry.name);
                var date = new Date();
                if(editMode){
                    var success = function (tx, results) {
                        checkIsItemExistInSyncModeSuccessForImageAddition(tx, results, entry.name, entry.fullPath);
                        
                    }
                    checkIsItemExistInSyncMode(mobileItemId, success);
                }else{
                    createImage(entry.name, date, itemId);
                    addToGallary(entry.fullPath, entry.name);
                }
                
                itemmHasEdited=true;
                numberOfImages++;
                
            }
            
            function fail(error) {
                console.log(error.code);
            }
            
            function checkIsItemExistInSyncModeSuccessForImageAddition(tx, results, imageName, imagePath){
                
                var description= $('#descriptionText').val();
                var quantity =Number($('#quantityText').val());
                var typeid=$('#itemTypeList').val();
                var itemname=$('#itemName').val();
                
                // there are items which have status sync
                if(results.rows.length>0){
                    var oldMobileItemId=results.rows.item(0).mobileitemid;
                    
                    var success = function (tx, results){
                        deleteSyncExistingItemfromDBSuccessForImageAddition(oldMobileItemId, imageName, imagePath);
                    }
                    
                    deleteSyncExistingItemfromDB(oldMobileItemId, success);
                    
                }
                else{
                    var date = new Date();
                    
                    if(!mobileItemId){
                        var date =new Date();
                        mobileItemId = device.uuid + date.getTime();
                        var saveSuccess = function (tx, results) {
                           
                            saveImageForExistingItem(imageName, date, mobileItemId);
                            
                            addLocalPhotoToGallery(imagePath, imageName, "LOCAL");
                        }
                        
                        saveExistingItem(mobileItemId, sbItemId, itemname, typeid, companyId, description, quantity, "FRESH", lastUpdatedDate, saveSuccess);
                    }
                    else{
                        saveImageForExistingItem(imageName, date, mobileItemId);
                        addLocalPhotoToGallery(imagePath, imageName, "LOCAL");
                        //updateExistingItemWithoutStatus(mobileItemId, itemname, typeid, companyId, description, quantity, lastUpdatedDate);
                    }
                }
                
                
            }
            function deleteSyncExistingItemfromDBSuccessForImageAddition(oldMobileItemId, imageName, imagePath){
                
                var description= $('#descriptionText').val();
                var quantity =Number($('#quantityText').val());
                var typeid=$('#itemTypeList').val();
                var itemname=$('#itemName').val();
                var date =new Date();
                mobileItemId = device.uuid + date.getTime();
                
                var success = function (tx, results){
                    
                    updateImagesMobileItemId(oldMobileItemId, mobileItemId);
                    saveImageForExistingItem(imageName, date, mobileItemId);
                    addLocalPhotoToGallery(imagePath, imageName, "LOCAL");
                }
                
                saveExistingItem(mobileItemId, sbItemId, itemname, typeid, companyId, description, quantity, "FRESH", lastUpdatedDate, success);
                
                // saveExistingItem(newMobileItemId, sbItemId, itemname, typeid, companyId, description, quantity, lastUpdatedDate, success);
                
            }
            
            function saveButtonClicked(){
                if(editMode){
                    if( detailsChanged==true ){
                        
                        checkIsItemExistInSyncMode(mobileItemId, checkIsItemExistInSyncModeSuccess);
                        
                    }
                    else{
                        
                        //search page
                        $.mobile.changePage("search.html");
                        return false;
                    }
                }
                else{
                    var date = new Date();
                    var description= $('#descriptionText').val();
                    var quantity =Number($('#quantityText').val());
                    var typeid=$('#itemTypeList').val();
                    var itemname=$.trim($('#itemName').val());
                    
                    if(itemname==''){
                        navigator.notification.alert("Please enter an Item name.", function(){}, "Validation Failed", "OK");
                    }
                    else if(typeid==''){
                        navigator.notification.alert("Please select an Item type.",function(){} , "Validation Failed", "OK");
                    }
                    else if(quantity==0){
                        navigator.notification.alert("Please enter a valid numeric value for Quantity.",function(){$('#quantityText').val('1')} , "Validation Failed", "OK");
                    }
                    
                    else if(numberOfImages==0){
                        navigator.notification.confirm(
                                                       'Are you sure you want to create this Item without any images?', // message
                                                       successUpdateItem,            // callback to invoke with index of button pressed
                                                       'Confirm Save Item',           // title
                                                       'NO,YES'         // buttonLabels
                                                       );
                    }
                    else{
                        
                        addnewItem();
                    }
                }
            }
            
            function checkIsItemExistInSyncModeSuccess(tx, results){
                
                var description= $('#descriptionText').val();
                var quantity =Number($('#quantityText').val());
                var typeid=$('#itemTypeList').val();
                var itemname=$.trim($('#itemName').val());
                
                
                if(itemname==''){
                    navigator.notification.alert("Please enter an Item name.", function(){}, "Validation Failed", "OK");
                }
                
                else if(quantity==''){
                    navigator.notification.alert("Please enter a valid numeric value for Quantity.",function(){$('#quantityText').val('1')} , "Validation Failed", "OK");
                }
                
                else{
                
                
                
                
                
                
                // item status is sync
                    if(results.rows.length>0){
                    var oldMobileItemId=results.rows.item(0).mobileitemid;
                    
                    var success = function (tx, results){
                        deleteSyncExistingItemfromDBSuccess(oldMobileItemId);
                    }
                    
                    deleteSyncExistingItemfromDB(oldMobileItemId, success);
                    
                    }else{
                    
                        if(!mobileItemId){
                            var date =new Date();
                            mobileItemId = device.uuid + date.getTime();
                            saveExistingItem(mobileItemId, sbItemId, itemname, typeid, companyId, description, quantity, "DIRTY", lastUpdatedDate, EditItemCreateSuccess);
                            
                        }
                        else{
                        
                        
                        updateExistingItemWhenbSaving(mobileItemId, itemname, typeid, companyId, description, quantity, "DIRTY", lastUpdatedDate, EditItemCreateSuccess);
                        }
                   
                    
                }
                
                //search page
                $.mobile.changePage("search.html");
                return false;
                
                }
            }
            function EditItemCreateSuccess(tx, results) {
                console.log("saveExistingItem");
                var description= $('#descriptionText').val();
                var quantity =Number($('#quantityText').val());
                var typeid=$('#itemTypeList').val();
                var itemname=$.trim($('#itemName').val());
                var status =1;
                //saveImage(mobileItemId);
                updateSearchResult(sbItemId, itemname, quantity, description, status,updateSearchResultSuccess);
            }
            
            function updateSearchResultSuccess(tx, results){
            console.log("updateSearchResultSuccess");
            }
            function deleteSyncExistingItemfromDBSuccess(oldMobileItemId){
                
            	var description= $('#descriptionText').val();
                var quantity =Number($('#quantityText').val());
                var typeid=$('#itemTypeList').val();
                 var itemname=$.trim($('#itemName').val());
            	
                var newMobileItemId = device.uuid + date.getTime();
                
                var success = function (tx, results){
                    
                    updateImagesMobileItemId(oldMobileItemId, newMobileItemId);
                }
                if(detailsChanged){
                	saveExistingItem(mobileItemId, sbItemId, itemname, typeid, companyId, description, quantity, "DIRTY", lastUpdatedDate, success);
                }
                else{
                	saveExistingItem(mobileItemId, sbItemId, itemname, typeid, companyId, description, quantity, "FRESH", lastUpdatedDate, success);
                }
                // saveExistingItem(newMobileItemId, sbItemId, itemname, typeid, companyId, description, quantity, lastUpdatedDate, success);
                
            }
            
            
            
            function successUpdateItem(buttonIndex){
                if(buttonIndex==2){
                    addnewItem();
                    
                }
            }
            
            //            function updateIteminDB(isAddNew){
            //
            //            var date = new Date();
            //            var description= $('#descriptionText').val();
            //            var quantity =Number($('#quantityText').val());
            //            var typeid=$('#itemTypeList').val();
            //            var itemname=$('#itemName').val();
            //
            //            if(itemname==''){
            //                navigator.notification.alert("Please enter an Item name.", function(){}, "Validation Failed", "OK");
            //            }
            //            else if(typeid==''){
            //                navigator.notification.alert("Please select an Item type.",function(){} , "Validation Failed", "OK");
            //            }
            //            else if(quantity==''){
            //                navigator.notification.alert("Please enter a valid numeric value for Quantity.",function(){$('#quantityText').val('1')} , "Validation Failed", "OK");
            //            }
            //            //alert(quantity);
            //            else{
            //                hasSync = true;
            //                $('.sync img').attr("src","css/images/icons/sync-02.png");
            //                saveItem(itemId, itemname, typeid, companyId, description, quantity, date);
            //                window.sessionStorage["itemType"] = $('#itemTypeList').val().toString();
            //                numberOfImages=0;
            //                if(isAddNew){
            //                    refreshPage();
            //                }
            //                else{
            //                     $.mobile.changePage("home.html");
            //                }
            //
            //
            //            }
            //
            //
            //
            //            }
            
            //            function addNewButtonClicked(){
            //
            //            if(numberOfImages==0){
            //                navigator.notification.confirm(
            //                                               'Are you sure you want to create this item without any images?', // message
            //                                               successAddNewItem,            // callback to invoke with index of button pressed
            //                                               'Confirm Save Item',           // title
            //                                               'NO,YES'         // buttonLabels
            //                                               );
            //            }
            //            else{
            //
            //                updateIteminDB(true);
            //            }
            //
            //            }
            //
            //            function successAddNewItem(buttonIndex){
            //                if(buttonIndex==2){
            //                    updateIteminDB(true);
            //
            //                }
            //            }
            
            function addnewItem(){
                var date = new Date();
                var description= $('#descriptionText').val();
                var quantity =Number($('#quantityText').val());
                var typeid=$('#itemTypeList').val();
                  var itemname=$.trim($('#itemName').val());
                
               
                    hasSync = true;
                    $('.sync img').attr("src","css/images/icons/sync-02.png");
                    saveItem(itemId, itemname, typeid, companyId, description, quantity, date);
                    window.sessionStorage["itemType"] = $('#itemTypeList').val().toString();
                    numberOfImages=0;
                    refreshPage();
                
            }
            
            function refreshPage(){
                
                var date = new Date();
                
                if (companyName.length > 5) {
                    companyName = companyName.substring(0, 5);
                }
                
                var formatedDate=date.toLocaleDateString();
                var postFix;
                if(window.localStorage["itemAutoGenerateDate"]!=formatedDate){
                    window.localStorage["itemAutoGenerateDate"]=formatedDate;
                    window.localStorage["itemAutoGenerateID"]="1";
                    
                }
                
                
                postFix=parseInt(window.localStorage["itemAutoGenerateID"]);
                console.log(temppostFix);
                var temppostFix= postFix + 1;
                window.localStorage["itemAutoGenerateID"]=temppostFix.toString();
                
                
                //                   var month;
                //                   if(date.getMonth()+1<10){
                //                       month = "0" + (date.getMonth()+1);
                //                   }else{
                //                       month = date.getMonth()+1;
                //                   }
                
                itemName = companyName.toUpperCase() +"-"+ (date.getDate()<10?"0":"") + date.getDate() + ((date.getMonth()+1<10)?"0":"") +(date.getMonth()+1) + date.getFullYear()
                + "-"+postFix;
                /*create item in db*/
                itemId = createItem(itemName, date, companyId);
                detailsChanged=false;
                $('#descriptionText').val('')
                $('#quantityText').val('1')
                $('#itemName').val(itemName);
                $('#deleteImage').addClass("disabled");
                $('#rightArrow').addClass("disabled");
                $('#leftArrow').addClass("disabled");
                $('.swipe-wrap').remove();
                $('#slider').append('<div id="swipe-wrap" class="swipe-wrap">');
                mySwipe = new Swipe(document.getElementById('slider'),{startSlide: 0,transitionEnd:controlGalleryNavigation });
                 $('#slider').addClass("disabledGallery");
                $('.swipe-wrap').append('<div id="noImage"><img src="css/images/pictures/photo.jpg" alt="Picture" /></div>');
                
                mySwipe.setup();
            }
            
            function controlGalleryNavigation(index, elem) {
               
                var numberOfChildren=$('#swipe-wrap').children().length;
                //alert(index);
                if(editMode==true){
                    
                    //$('#rightArrow').removeClass("disabled");
                    
                    if(index==0){
                        
                        $('#leftArrow').addClass("disabled");
                    }
                    
                    if(index > 0){
                        $('#leftArrow').removeClass("disabled");
                        
                    }
                    if(index < (numberOfChildren-1)){
                        $('#rightArrow').removeClass("disabled");
                    }
                    if(index==(numberOfChildren-1) && isAllImagesLoaded){
                        $('#rightArrow').addClass("disabled");
                    }
                    
                }else{
                    
                    if(index==0){
                        
                        $('#leftArrow').addClass("disabled");
                    }
                    if(index==(numberOfChildren-1)){
                        $('#rightArrow').addClass("disabled");
                    }
                    
                    if(index > 0){
                        $('#leftArrow').removeClass("disabled");
                        
                    }
                    if(index < (numberOfChildren-1)){
                        $('#rightArrow').removeClass("disabled");
                    }
                }
                
                
                
            }
            
            function cancelItem(){
                if(editMode==true){
                    
                    if(!detailsChanged){
                        //change to search page
                        $.mobile.changePage("search.html");
                        return false;
                    }else{
                        navigator.notification.confirm(
                                                       'You will loose all changes. Are you sure you want to continue?', // message
                                                       onEditCancelConfirm,            // callback to invoke with index of button pressed
                                                       'Cancel Item Edit',           // title
                                                       'NO,YES'         // buttonLabels
                                                       );
                    }
                    
                }
                else{
                    navigator.notification.confirm(
                                                   'You are going to cancel Item creation. Are you sure you want to continue?', // message
                                                   onCancelConfirm,            // callback to invoke with index of button pressed
                                                   'Cancel Item Creation',           // title
                                                   'NO,YES'         // buttonLabels
                                                   );
                                                   
                }
            }
            
            function onEditCancelConfirm(buttonIndex){
                if(buttonIndex==2){
                    
                    $.mobile.changePage("search.html");
                    return false;
//                    if(isItemAlreadySavedInDb){
//                        alert("al");
//                        markUnsavedImagesToDeleteForAlreadyEditedAndSavedItemInDb(mobileItemId);
//                        $.mobile.changePage("home.html");
//                        return false;
//                    }else{
//                        alert("nal");
//                        markUnsavedImagesToDeleteForItemNotEditedAndSavedInDb(mobileItemId);
//                        $.mobile.changePage("home.html");
//                        return false;
//                    }
//                    //return false;
                }
                
            }
            function onCancelConfirm(buttonIndex) {
                if(buttonIndex==2){
                    removeItem(itemId);
                    $.mobile.changePage("home.html");
                    return false;
                }
            }
            
            function onDeleteConfirm(buttonIndex) {
                
                if(buttonIndex==2){
                    if(editMode){
                        var position= mySwipe.getPos();
                    var showingDiv= $( "div[data-index='"+position+"']");
                    var pictureType=showingDiv.attr("title");
                    var deletedImageName = showingDiv.children('img').attr("title");
                    if(pictureType=="LOCAL"){
                        
                        var position= mySwipe.getPos();
                        
                        var showingDiv= $( "div[data-index='"+position+"']");
                        var deletedImageName = showingDiv.children('img').attr("title");
                        
                        removeImage(deletedImageName, showingDiv);
                    }
                    else{
                        
                        var success = function (tx, results) {
                            
                            var deleteImageCount=results.rows.item(0).deleteimagecount;
                            removeServerImage(deleteImageCount, deletedImageName,  showingDiv);
                        }
                        checkImageIsAlreadydeleted(deletedImageName, success);
                        
                    }
                    
                    }else{
                    var position= mySwipe.getPos();
                    
                    var showingDiv= $( "div[data-index='"+position+"']");
                    var deletedImageName = showingDiv.children('img').attr("title");
                    
                    removeImage(deletedImageName, showingDiv);
                    }
                }
            }
            function removeServerImage(deleteImageCount, deletedImageName,  showingDiv){
                
                if(deleteImageCount>0)
                {
                    showingDiv.remove();
                    manageNoImageInEditorMode();
                    mySwipe.setup();
                    mySwipe.prev();
                    deleteImage(deletedImageName);
                    console.log("markImageTobedeleted ");
                    numberOfImages--;
                }
                else{
                    var success = function (tx, results) {
                        checkIsItemExistInSyncModeSuccessForImageDeletion(tx, results, deletedImageName,  showingDiv);
                        
                    }
                    checkIsItemExistInSyncMode(mobileItemId, success);
                }
            
            }
            
            
            
            function checkIsItemExistInSyncModeSuccessForImageDeletion(tx, results, deletedImageName,  showingDiv){
                
                var description= $('#descriptionText').val();
                var quantity =Number($('#quantityText').val());
                var typeid=$('#itemTypeList').val();
                var itemname=$('#itemName').val();
                
                // there are items which have status sync
                if(results.rows.length>0){
                    var oldMobileItemId=results.rows.item(0).mobileitemid;
                    
                    var success = function (tx, results){
                        deleteSyncExistingItemfromDBSuccessForImageDeletion(oldMobileItemId, deletedImageName, showingDiv);
                    }
                    
                    deleteSyncExistingItemfromDB(oldMobileItemId, success);
                    
                }
                else{
                    var date = new Date();
                    
                    if(!mobileItemId){
                        var date =new Date();
                        mobileItemId = device.uuid + date.getTime();
                        var saveSuccess = function (tx, results) {
                            
                            deleteServerImage(mobileItemId, deletedImageName);
                            
//                            saveImageForExistingItem(imageName, date, mobileItemId);
//                            addLocalPhotoToGallery(imagePath, imageName, "LOCAL");
                        }
                        saveExistingItem(mobileItemId, sbItemId, itemname, typeid, companyId, description, quantity, "FRESH", lastUpdatedDate, saveSuccess);
                    }
                    else{
                         deleteServerImage(mobileItemId, deletedImageName);
//                        saveImageForExistingItem(imageName, date, mobileItemId);
//                        addLocalPhotoToGallery(imagePath, imageName, "LOCAL");

                    }
                    
                    showingDiv.remove();
                    manageNoImageInEditorMode();
                    mySwipe.setup();
                    mySwipe.prev();
                    deleteImage(deletedImageName);
                    console.log("markImageTobedeleted ");
                    numberOfImages--;
                }
                
                
            }
            
            function deleteSyncExistingItemfromDBSuccessForImageDeletion(oldMobileItemId, deletedImageName, showingDiv){
                
                var description= $('#descriptionText').val();
                var quantity =Number($('#quantityText').val());
                var typeid=$('#itemTypeList').val();
                var itemname=$('#itemName').val();
                var date =new Date();
                mobileItemId = device.uuid + date.getTime();
                
                var success = function (tx, results){
                    
                    updateImagesMobileItemId(oldMobileItemId, mobileItemId);
                    deleteServerImage(mobileItemId, deletedImageName);
                    showingDiv.remove();
                    mmanageNoImageInEditorMode();
                    mySwipe.setup();
                    mySwipe.prev();
                    deleteImage(deletedImageName);
                    console.log("markImageTobedeleted ");
                    numberOfImages--;
//                    saveImageForExistingItem(imageName, date, mobileItemId);
//                    addLocalPhotoToGallery(imagePath, imageName, "LOCAL");
                }
                
                saveExistingItem(mobileItemId, sbItemId, itemname, typeid, companyId, description, quantity, "FRESH", lastUpdatedDate, success);
                
                // saveExistingItem(newMobileItemId, sbItemId, itemname, typeid, companyId, description, quantity, lastUpdatedDate, success);
                
            }
            
            
            
            
            
            
            
            function deleteTakenImage(){
                
                navigator.notification.confirm(
                                               'Image will be deleted permenantly. Are you sure you want to continue?', // message
                                               onDeleteConfirm,            // callback to invoke with index of button pressed
                                               'Image Deletion',           // title
                                               'NO,YES'         // buttonLabels
                                               );
                                               
                                               
            }
            
            function removeImage(deletedImageName, showingDiv) {
                
                var success = function (tx, results) {
                    
                    showingDiv.remove();
                    
                    if(editMode){
                        manageNoImageInEditorMode();
                    }
                    else{
                        manageNoImage();
                    }
                    
                    mySwipe.setup();
                    mySwipe.prev();
                    deleteImage(deletedImageName);
                    console.log("markImageTobedeleted ");
                    numberOfImages--;
                }
                
                markImageTobedeleted(deletedImageName, success);
                
                
            }
            
            function navigateSync(){
                // $.mobile.changePage("sync.html");
                if(editMode){
                    if(detailsChanged==true){
                        navigator.notification.confirm(
                                                       'You have unsaved changes. Are you sure you want to navigate?', // message
                                                       onNavigatesyncConfirm,            // callback to invoke with index of button pressed
                                                       'Confirm Navigation',           // title
                                                       'NO,YES'         // buttonLabels
                                                       );
                    }
                    else{
                        $.mobile.changePage("sync.html");
                        return false;
                    }
                    
                }
                else{
                if(numberOfImages>0 || detailsChanged==true){
                    navigator.notification.confirm(
                                                   'You have unsaved changes. Are you sure you want to navigate?', // message
                                                   onNavigatesyncConfirm,            // callback to invoke with index of button pressed
                                                   'Confirm Navigation',           // title
                                                   'NO,YES'         // buttonLabels
                                                   );
                                                   //return false;
                }
                else{
                    removeItem(itemId);
                    //window.sessionStorage["itemType"] = $('#itemTypeList').val().toString();
                    $.mobile.changePage("sync.html");
                    return false;
                }
                }
            }
            
            function navigateHome(){
                //$.mobile.changePage("home.html");
                if(editMode){
                    if(detailsChanged==true){
                        navigator.notification.confirm(
                                                       'You have unsaved changes. Are you sure you want to navigate?', // message
                                                       onNavigatehomeConfirm,            // callback to invoke with index of button pressed
                                                       'Confirm Navigation',           // title
                                                       'NO,YES'         // buttonLabels
                                                       );
                    }
                    else{
                        $.mobile.changePage("home.html");
                        return false;
                    }
                
                }
                else{
                if(numberOfImages>0 || detailsChanged==true ){
                    navigator.notification.confirm(
                                                   'You have unsaved changes. Are you sure you want to navigate?', // message
                                                   onNavigatehomeConfirm,            // callback to invoke with index of button pressed
                                                   'Confirm Navigation',           // title
                                                   'NO,YES'         // buttonLabels
                                                   );
                                                   //return false;
                }
                else{
                    removeItem(itemId);
                    //window.sessionStorage["itemType"] = $('#itemTypeList').val().toString();
                    $.mobile.changePage("home.html");
                    return false;
                    
                }
                }
            }
            function onNavigatehomeConfirm(buttonIndex) {
                
                if(buttonIndex==2){
                    if(!editMode){
                    removeItem(itemId);
                    }
                    //window.sessionStorage["itemType"] = $('#itemTypeList').val().toString();
                    $.mobile.changePage("home.html");
                    return false;
                    
                }
                
            }
            
            function onNavigatesyncConfirm(buttonIndex) {
                
                if(buttonIndex==2){
                    if(!editMode){
                        removeItem(itemId);
                    }
                    //window.sessionStorage["itemType"] = $('#itemTypeList').val().toString();
                    $.mobile.changePage("sync.html");
                    return false;
                }
                
            }
            function imageNavigateRight(){
                
                if(editMode==true){
                    if(mySwipe.getPos()== (mySwipe.getNumSlides()-1)){
//                        if(currentServerImage < serverImages.length){
//                            
//                            if(!isImageStillLoading){
//                                isImageStillLoading=true;
//                                //loadNextImage(sbItemId, companyId, nextDocumentMediaId, loadNextImageSuccess, loadNextImageError);
//                                setNextImageinGallery();
//                            }
//                            
//                        }else if (currentLocalImage<localImages.length){
//                            
//                            loadLocalImagesToGallery();
//                        }else{
//                            $('#rightArrow').addClass("disabled");
//                            
//                        }
                        $.mobile.loading('show');
                        setNextImageinGallery();
                    }
                    else{
                        mySwipe.next();
                    }
                }
                else{
                    mySwipe.next();
                }
            }
            
            
            function setNextImageinGallery(){
                
                var documentMediaId =serverImages[currentServerImage];
                
                var success = function (tx, results) {
                    
                    var deleteImageCount=results.rows.item(0).deleteimagecount;
                    
                    if(deleteImageCount>0)
                    {
                        currentServerImage++;
                        setNextImageinGallery();
                    }
                    else{
                        loadNextImage(sbItemId, companyId, documentMediaId, loadNextImageSuccess, loadNextImageError);
                    }
                    
                    
                    
                }
                
                if(currentServerImage < serverImages.length){
                    checkImageIsAlreadydeleted(documentMediaId, success);
                    
                }else if (currentLocalImage<localImages.length){
                    
                    loadLocalImagesToGallery();
                }else{
                    $('#rightArrow').addClass("disabled");
                    isAllImagesLoaded=true;
                    $.mobile.loading('hide');
                }
            }
            
            
            function loadLocalImagesToGallery(){
                
                getAddedImagesforExistingItem(localImages[currentLocalImage]);
                currentLocalImage++;
                
                if(currentLocalImage>=localImages.length){
                    isAllImagesLoaded=true;
                    $('#rightArrow').addClass("disabled");
                    
                }
            }
            
            
            
            function loadNextImageSuccess(data){
                
                if(data.Status=="OK"){
                    currentServerImage++;
                    addserverPhotoToGallery(data.Image ,data.DocumentMediaId, "SERVICE");
                    
                    
                    isImageStillLoading=false;
                    
                    //alert(nextDocumentMediaId);
                    if( currentServerImage >= serverImages.length && localImages.length==0){
                        isAllImagesLoaded=true;
                        $('#rightArrow').addClass("disabled");
                        
                    }
                    
                } else{
                    currentServerImage++;
                    
                    isImageStillLoading=false;
                    setNextImageinGallery();
                    
                }
                
            }
            
            function loadNextImageError(error){
                isImageStillLoading=false;
                var msg = 'loadNextImageError ' + error.code;
                //navigator.notification.alert(msg, null, 'Image Deletion Error');
                console.log(msg);
            }
            
            function gotoItemPage(){
                var itemURL;
                var val;
                $.ajax({
                       url : "config.xml",
                       dataType : "html",
                       success : function(xmlResponse) {
                       itemURL = $(xmlResponse).find('itemurl').attr('value');
                       },
                       error : function(error) {
                       },
                       async : false
                       });
                      
                       itemURL=itemURL.replace("{0}",sbItemId);
                       itemURL=itemURL.replace("{1}",companyId);
                       itemURL = encodeURI(itemURL);
                        window.open(itemURL, '_blank', 'location=yes');
                        return false;
            }
           
            
            function navigateSettings(){
//                $.mobile.changePage("settings.html");
//                return false;
                    if(editMode){
                        if(detailsChanged==true){
                            navigator.notification.confirm(
                                                           'You have unsaved changes. Are you sure you want to navigate?', // message
                                                           onNavigateSettingsConfirm,            // callback to invoke with index of button pressed
                                                           'Confirm Navigation',           // title
                                                           'NO,YES'         // buttonLabels
                                                           );
                        }
                        else{
                            $.mobile.changePage("settings.html");
                            return false;
                        }
                        
                    }
                    else{
                        if(numberOfImages>0 || detailsChanged==true ){
                            navigator.notification.confirm(
                                                           'You have unsaved changes. Are you sure you want to navigate?', // message
                                                          onNavigateSettingsConfirm,            // callback to invoke with index of button pressed
                                                           'Confirm Navigation',           // title
                                                           'NO,YES'         // buttonLabels
                                                           );
                                                           //return false;
                        }
                        else{
                            removeItem(itemId);
                            //window.sessionStorage["itemType"] = $('#itemTypeList').val().toString();
                            $.mobile.changePage("settings.html");
                            return false;
                            
                        }
                    }
            }
            function onNavigateSettingsConfirm(buttonIndex) {
                
                if(buttonIndex==2){
                    if(!editMode){
                        removeItem(itemId);
                    }
                    //window.sessionStorage["itemType"] = $('#itemTypeList').val().toString();
                    $.mobile.changePage("settings.html");
                    return false;
                    
                
                }
                
            }
                </script>
            <div id="item-background"></div>
            <div class="push-footer">
                <div class="padding">
                    <!-- Header -->
                    <header>
                        <div id="statusBar" style="height:20px;background:#fff;display:none;"></div>
                        <div id="header">
                            <div class="area">
                                <div class="header">
                                    <a href="#" class="home" onclick="navigateHome()"><img
                                        src="css/images/icons/home.png" alt="Home" /> </a>
                                    <h1>
                                        <a href="#" class="logotype"><img
                                            src="css/images/logotype.png" alt="STAGEBITZ" /> </a>
                                    </h1>
                                    <a href="#" class="settings" onclick="navigateSettings()"><img
                                        src="css/images/icons/settings.png" alt="Settings" /> </a>
                                    <a href="#" class="sync" onclick="navigateSync()">
                                        <img src="css/images/icons/sync.png" alt="Sync" /></a>
                                </div>
                            </div>
                        </div>
                    </header>
                    <!-- Content -->
                    <div id="content" class="item">
                        <div class="area">
                            <div class="top">
                                <div class="box-link">
                                    <a id="leftArrow" class="disabled" href="#"><img src="css/images/icons/large-arrow-left.png"
                                        alt="Picture" onclick='mySwipe.prev()'/> </a>
                                    <a id="viewInBrowser" class="disabled" href="#">
                                            <img
                                            src="css/images/icons/icon-4.png" alt="Picture" onclick="gotoItemPage()" /> </a>
                                        <a id="deleteImage" onclick="deleteTakenImage()" class="disabled" href="#"><img src="css/images/icons/icon-5.png"
                                            alt="Picture" /> </a>
                                </div>
                                
                                <div class="photo">
                                    <div id="slider" class="swipe">
                                        <div id="swipe-wrap" class="swipe-wrap">
                                            <div id="noImage"><img src="css/images/pictures/photo.jpg" alt="Picture" /></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="box-link right">
                                    <a id="rightArrow" href="#"><img
                                        src="css/images/icons/large-arrow-right.png" alt="Picture" onclick='imageNavigateRight()'/>
                                    </a>
                                    <a id="galleryButton" onclick="galleryIconClicked()" href="#"><img src="css/images/icons/icon-6.png"
                                        alt="Picture" /> </a>
									<a id="cameraButton"  onclick="cameraIconClicked()" href="#"><img
                                        src="css/images/icons/icon-7.png" alt="Picture" /> </a>
                                </div>
                                <div class="clear">&nbsp;</div>
                            </div>
                            <div class="clear">&nbsp;</div>
                            
                            <div class="boxes">
                                <form action="#" method="get">
                                    <div class="form-box">
                                        <div class="row">
                                            <input type="text" id="itemName" onblur="itemNameOnBlur()"
											onmouseup="itemNameOnFocus()" name="name" data-role="none" maxlength="100"/>
                                            <div class="clear">&nbsp;</div>
                                        </div>
                                    </div>
                                    <div class="row indent selectWrap">
                                        <select id="itemTypeList" name="find" data-role="none"
                                            >
                                        </select>
                                        <div class="clear">&nbsp;</div>
                                    </div>
                                    <div class="clear">&nbsp;</div>
                                    <div class="row">
                                        <textarea  rows="5" cols="5"
                                            placeholder="Description..."
                                            id="descriptionText" name="message" data-role="none"></textarea>
                                        <div class="clear">&nbsp;</div>
                                    </div>
                                    <div class="small status">
                                        <label id="itemStatusLabel">Status:</label>
                                        <label id="itemStatus"></label>
                                    </div>
                                    <div class="small">
                                        <label for="name" style="text-align: right">Qty</label> <input id="quantityText"
										type="number" value="1" data-role="none" />
                                    </div>
                                </form>
                                <div class="clear">&nbsp;</div>
                            </div>
                            <div class="clear">&nbsp;</div>
                        </div>
                    </div>
                    <div class="clear">&nbsp;</div>
                </div>
            </div>
            
            <!-- Footer -->
            <footer>
                <div id="footer" class="links">
                    <div class="area">
                        <a href="#" class="icon"><img src="css/images/icons/icon.png"
                            alt="icon" onclick="GoToVoiceContactPage()"/> </a>
                        <a id="createItem" onclick="saveButtonClicked()" href="#"><img
                            src="css/images/icons/icon-2.png" alt="icon" /> </a>
                        <a onclick="cancelItem()" href="#"><img
                            src="css/images/icons/close.png" alt="icon" /> </a>
                        
                    </div>
                    <div class="clear">&nbsp;</div>
                </div>
            </footer>
        </div>
    </body>
</html>
